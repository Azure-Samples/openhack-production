trigger:
  - master

pr: none

pool:
  vmImage: "ubuntu-latest"

stages:
  - stage: BackendAPI
    displayName: API
    jobs:
      - job: DeployGlobalInfrastructure
        displayName: Resources
        steps:
        - task: UseDotNet@2
          inputs:
            version: '3.1.100'
        - task: DotNetCoreCLI@2
          displayName: Build
          inputs:
            command: build
            projects: '**/*.csproj'
            arguments: '--configuration Release'   
        - task: DotNetCoreCLI@2
          inputs:
            command: test
            projects: '**/*Tests/*.csproj'
            arguments: '--configuration $(buildConfiguration) --collect "Code coverage"'

        - task: DotNetCoreCLI@2
          inputs:
            command: publish
            publishWebProjects: True
            arguments: '--configuration $(BuildConfiguration) --output $(Build.ArtifactStagingDirectory)'
            zipAfterPublish: True

        - task: PublishBuildArtifacts@1
          inputs:
            pathtoPublish: '$(Build.ArtifactStagingDirectory)' 

        - task: AzureRmWebAppDeployment@4
          inputs:
            ConnectionType: 'AzureRM'
            azureSubscription: 'azure'
            appType: 'webApp'
            WebAppName: 'backend-prodoh-urlist-test-centralus'
            packageForLinux: '$(Build.ArtifactStagingDirectory)/**/*.zip'



              
         

